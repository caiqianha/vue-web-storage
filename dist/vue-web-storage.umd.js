/*!
 * vue-web-super-storage v1.0.0
 * (c) 2025 caiqianha
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VueWebStorage={},e.Vue)}(this,function(e,t){"use strict";var r;function s(e,t="vue-web-storage"){const r=t.length;let s="";for(let o=0;o<e.length;o++){const n=e.charCodeAt(o),i=t.charCodeAt(o%r);s+=String.fromCharCode(n^i)}return btoa(s)}function o(e,t="vue-web-storage"){try{const r=atob(e),s=t.length;let o="";for(let e=0;e<r.length;e++){const n=r.charCodeAt(e),i=t.charCodeAt(e%s);o+=String.fromCharCode(n^i)}return o}catch(t){return console.warn("解密失败:",t),e}}function n(e){return null!==e&&Date.now()>e}function i(e){return void 0===e?null:Date.now()+e}function a(e,t=!1,r){const o=JSON.stringify(e);return t?s(o,r):o}function c(e,t=!1,r){try{const s=t?o(e,r):e;return JSON.parse(s)}catch(e){return console.warn("反序列化失败:",e),null}}function l(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(e=>l(e));if("object"==typeof e){const t={};return Object.keys(e).forEach(r=>{t[r]=l(e[r])}),t}return e}e.StorageType=void 0,(r=e.StorageType||(e.StorageType={})).LOCAL="localStorage",r.SESSION="sessionStorage";class h{constructor(t={}){this.listeners=new Map,this.options={type:e.StorageType.LOCAL,defaultExpires:0,prefix:"vue-storage-",encrypt:!1,encryptKey:"vue-web-storage",...t},this.storage=this.options.type===e.StorageType.LOCAL?localStorage:sessionStorage,this.clearExpired()}getFullKey(e){return this.options.prefix+e}emit(e,t={}){const r=this.listeners.get(e);if(r&&r.size>0){const s={type:e,timestamp:Date.now(),...t};r.forEach(e=>{try{e(s)}catch(e){console.error("Storage event listener error:",e)}})}}set(e,t,r={}){try{const s=this.getFullKey(e),o=i((r.expires??this.options.defaultExpires)||void 0),n={value:l(t),expires:o,created:Date.now()},c=a(n,r.encrypt??this.options.encrypt,this.options.encryptKey);return this.storage.setItem(s,c),this.emit("set",{key:e,value:t}),!0}catch(e){return console.error("Storage set error:",e),!1}}get(e,t={}){try{const r=this.getFullKey(e),s=this.storage.getItem(r);if(!s)return t.defaultValue??null;const o=c(s,this.options.encrypt,this.options.encryptKey);return o&&"object"==typeof o&&"value"in o?n(o.expires)?(this.remove(e),this.emit("expired",{key:e}),t.defaultValue??null):(this.emit("get",{key:e,value:o.value}),l(o.value)):t.defaultValue??null}catch(e){return console.error("Storage get error:",e),t.defaultValue??null}}has(e){try{const t=this.getFullKey(e),r=this.storage.getItem(t);if(!r)return!1;const s=c(r,this.options.encrypt,this.options.encryptKey);return!(!s||"object"!=typeof s||!("expires"in s))&&(!n(s.expires)||(this.remove(e),!1))}catch(e){return console.error("Storage has error:",e),!1}}remove(e){try{const t=this.getFullKey(e);return this.storage.removeItem(t),this.emit("remove",{key:e}),!0}catch(e){return console.error("Storage remove error:",e),!1}}clear(){try{const e=[];for(let t=0;t<this.storage.length;t++){const r=this.storage.key(t);r&&r.startsWith(this.options.prefix)&&e.push(r)}return e.forEach(e=>{this.storage.removeItem(e)}),this.emit("clear"),!0}catch(e){return console.error("Storage clear error:",e),!1}}clearExpired(){let e=0;const t=[];try{for(let e=0;e<this.storage.length;e++){const r=this.storage.key(e);if(!r||!r.startsWith(this.options.prefix))continue;const s=this.storage.getItem(r);if(!s)continue;const o=c(s,this.options.encrypt,this.options.encryptKey);o&&"object"==typeof o&&"expires"in o&&n(o.expires)&&t.push(r)}return t.forEach(t=>{this.storage.removeItem(t),e++}),e>0&&this.emit("expired"),e}catch(t){return console.error("Storage clearExpired error:",t),e}}keys(){const e=[],t=this.options.prefix.length;try{for(let r=0;r<this.storage.length;r++){const s=this.storage.key(r);if(s&&s.startsWith(this.options.prefix)){const r=s.substring(t);this.has(r)&&e.push(r)}}}catch(e){console.error("Storage keys error:",e)}return e}getStats(){let e=0,t=0,r=0,s=0;try{for(let o=0;o<this.storage.length;o++){const i=this.storage.key(o);if(!i||!i.startsWith(this.options.prefix))continue;const a=this.storage.getItem(i);if(!a)continue;e++,s+=i.length+a.length;const l=c(a,this.options.encrypt,this.options.encryptKey);l&&"object"==typeof l&&"expires"in l&&n(l.expires)?t++:r++}}catch(e){console.error("Storage getStats error:",e)}return{total:e,expired:t,valid:r,usedBytes:s}}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){const r=this.listeners.get(e);r&&r.delete(t)}getStorage(){return this.storage}getOptions(){return{...this.options}}}function u(e,r,s={}){const o=new h(s),n=o.get(e,{defaultValue:r}),i=t.ref(n??r),a=t.watch(i,t=>{o.set(e,t)},{deep:!0});return t.onUnmounted(()=>{a()}),[i,(t,r)=>{i.value=t,o.set(e,t,r)},()=>{o.remove(e),i.value=r}]}class g{constructor(e,r,s={}){this.key=e,this.defaultValue=r,this.storage=new h(s);const o=this.storage.get(e,{defaultValue:r});this.state=t.ref(o??r),this.startWatching()}startWatching(){this.stopWatcher=t.watch(this.state,e=>{this.storage.set(this.key,e)},{deep:!0})}get value(){return this.state.value}set value(e){this.state.value=e}get ref(){return this.state}setValue(e,t){this.state.value=e,this.storage.set(this.key,e,t)}reset(){this.state.value=this.defaultValue}remove(){this.storage.remove(this.key),this.state.value=this.defaultValue}refresh(){const e=this.storage.get(this.key,{defaultValue:this.defaultValue});this.state.value=e??this.defaultValue}destroy(){this.stopWatcher&&(this.stopWatcher(),this.stopWatcher=void 0)}}const p={install(t,r={}){const{localStorage:s={},sessionStorage:o={},globalName:n="$storage"}=r,i=new h({type:e.StorageType.LOCAL,prefix:"vue-local-",...s}),a=new h({type:e.StorageType.SESSION,prefix:"vue-session-",...o}),c={local:i,session:a,setLocal:i.set.bind(i),getLocal:i.get.bind(i),removeLocal:i.remove.bind(i),clearLocal:i.clear.bind(i),setSession:a.set.bind(a),getSession:a.get.bind(a),removeSession:a.remove.bind(a),clearSession:a.clear.bind(a),set:i.set.bind(i),get:i.get.bind(i),remove:i.remove.bind(i),clear:i.clear.bind(i),has:i.has.bind(i),keys:i.keys.bind(i),clearExpired:i.clearExpired.bind(i),getStats:i.getStats.bind(i)};t.config.globalProperties[n]=c,t.provide("webStorage",c),t.provide("localStorage",i),t.provide("sessionStorage",a)}},f=new h({type:e.StorageType.LOCAL,prefix:"vue-local-"}),y=new h({type:e.StorageType.SESSION,prefix:"vue-session-"});e.StorageState=g,e.VueWebStoragePlugin=p,e.WebStorage=h,e.calculateExpires=i,e.createStorageState=function(e,t,r={}){return new g(e,t,r)},e.decrypt=o,e.deepClone=l,e.default=p,e.deserialize=c,e.encrypt=s,e.formatBytes=function(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},e.getStorageSize=function(e){let t=0;for(let r in e)e.hasOwnProperty(r)&&(t+=e[r].length+r.length);return t},e.isExpired=n,e.localStorage=f,e.serialize=a,e.sessionStorage=y,e.useBatchStorage=function(e={}){const t=new h(e);return{storage:t,batchSet:(e,r)=>{Object.entries(e).forEach(([e,s])=>{t.set(e,s,r)})},batchGet:(e,r)=>{const s={};return e.forEach(e=>{s[e]=t.get(e,r)}),s},batchRemove:e=>{e.forEach(e=>{t.remove(e)})}}},e.useLocalStorage=function(t,r,s={}){return u(t,r,{...s,type:e.StorageType.LOCAL})},e.useSessionStorage=function(t,r,s={}){return u(t,r,{...s,type:e.StorageType.SESSION})},e.useStorage=u,e.version="1.0.0",Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=vue-web-storage.umd.js.map
